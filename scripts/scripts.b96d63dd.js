"use strict";angular.module("retailerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]);var retailerApp=angular.module("retailerApp");retailerApp.controller("MainCtrl",["$scope","$http","$timeout",function(a,b,c){function d(c){var d=c+".json";b.get("/retailer/dist/scripts/json/"+d).then(function(b){a.allItems[c]=b.data.items},function(a){console.error("response: ",a)})}a.categories=[],a.currentCategory="",a.categoryHolder="",a.allItems={},a.infoList={items:[]},a.holderInfoList=[],a.searchTerms="",a.compareItems=[],a.holderCompareItems=[],a.cartItems=[],a.cartItemsLength=a.cartItems.length,a.compareItemsLength=a.compareItems.length,a.grandTotal=0,b.get("/retailer/dist/scripts/json/categories.json").then(function(b){a.categories=b.data.categories;for(var c=0,e=a.categories.length;e>c;c++)d(a.categories[c]);""===a.currentCategory&&a.setCategory(a.categories[0])},function(a){console.error("response: ",a)}),a.setCategory=function(b){$(".shoppingCartDisplay").hide(),$(".compareDisplay").hide(),$(".sortItems").show(),$(".collapsibleDisplay").fadeOut(),c(function(){a.currentCategory=b,a.infoList.items=a.allItems[b].slice(),$(".collapsibleDisplay").fadeIn()},400)},a.searchItems=function(){if(a.categoryHolder&&(a.currentCategory=a.categoryHolder),a.searchTerms.length>1&&""!==a.searchTerms){var b,c=a.searchTerms.trim(),d=new RegExp(c,"i"),e=/[\s]+/,f=[];if(0===a.holderInfoList.length)for(var g=0,h=a.categories.length;h>g;g++){var i=a.allItems[a.categories[g]];a.holderInfoList=a.holderInfoList.concat(i)}f=c.split(e),a.infoList.items.length=0;for(var j=0,k=a.holderInfoList.length;k>j;j++){b=a.holderInfoList[j];for(var l in b)if(b.hasOwnProperty(l)&&"image"!==l&&"imageThumb"!==l&&"id"!==l&&"$$hashKey"!==l&&d.test(b[l])&&c.length>3){a.infoList.items.push(b);break}}if(0===a.infoList.items.length)for(var m=0,n=a.holderInfoList.length;n>m;m++){b=a.holderInfoList[j];for(var o in b)if(b.hasOwnProperty(o)&&"image"!==o&&"imageThumb"!==o&&"id"!==o&&"$$hashKey"!==o&&"content"!==o)for(var p=0,q=f.length;q>p;p++){var r=new RegExp(f[p],"i");if(r.test(b[o])){a.infoList.items.push(b);break}}}a.categoryHolder=a.currentCategory,a.currentCategory="Search Results: "+c}},a.$watch("searchTerms.length",function(){0===a.searchTerms.length&&a.holderInfoList.length>0&&(a.infoList.items.length=0,a.setCategory(a.categoryHolder))}),a.$watch("compareItems.length",function(){a.compareItemsLength=a.compareItems.length}),a.$watch("cartItems.length",function(){a.cartItemsLength=a.cartItems.length}),a.addToCart=function(b){b.inCart=!0;for(var c=!1,d=0,e=a.cartItems.length;e>d;d++)b.id===a.cartItems[d].id&&(c=!0);c===!1&&(a.grandTotal+=b.price,a.cartItems.push(b))},a.removeFromCart=function(b){for(var c=0,d=a.cartItems.length;d>c;c++)b===a.cartItems[c]&&(a.grandTotal-=b.price,a.cartItems.splice(c,1),b.inCart=!1)},a.addCompare=function(b){for(var c=!1,d=0,e=a.compareItems.length;e>d;d++)b.id===a.compareItems[d].id&&(c=!0);c===!1&&a.compareItems.push(b)},a.removeCompare=function(b){for(var c,d=$(".compareDisplay li"),e=$(d[0]).width(),f=0,g=a.compareItems.length;g>f;f++)if(b===a.compareItems[f]){c=f,$(d[c]).hide(),a.compareItems.splice(c,1);break}if("undefined"!=typeof c){var h=0;angular.forEach(d,function(a){if(a!==d[c]){var b=h*(e+25);$(a).css({left:b+"px"}),h++}})}},a.switchView=function(b){"compare"===b?a.compareItems.length>0&&($(".collapsibleDisplay").hide(),$(".shoppingCartDisplay").hide(),$(".sortItems").hide(),$(".compareDisplay").show(),$(".showItems").show(),$("body, html").animate({scrollTop:0},0)):"cart"===b&&($(".compareDisplay").hide(),$(".collapsibleDisplay").hide(),$(".shoppingCartDisplay").show(),$(".sortItems").hide(),$(".showItems").show(),$("body, html").animate({scrollTop:0},0))},a.sortItemsByPrice=function(b){$(".collapsibleDisplay").fadeOut(),c(function(){a.infoList.items.sort(function(a,c){var d,e;return"high"===b?(d=c,e=a):(d=a,e=c),d.price>e.price?1:-1}),$(".collapsibleDisplay").fadeIn()},400)}}]),retailerApp.directive("collapsible",["$window",function(a){return{restrict:"E",templateUrl:"views/collapsible.html",link:function(b,c){function d(){var b=a.outerHeight,c=i.offset().top;k.attr("src",j.attr("src").replace("thumb_","")),j.fadeOut(),$("body, html").animate({scrollTop:c}),k.animate({opacity:1},800),h.addClass("expand").css({height:b}),k.on("click",f),i.off("click",d),i.on("click",e)}function e(){h.removeClass("expand").css({height:"75px",transition:".8s"}),k.animate({opacity:0},320),j.delay(200).fadeIn(),k.hasClass("zoom")&&g(),i.on("click",d),i.off("click",e),k.on("click",d)}function f(){k.addClass("zoom"),l.fadeOut(),k.css({marginLeft:"12%"}),k.off("click",f),k.on("click",g)}function g(){k.css({marginLeft:0}),k.removeClass("zoom").css({transition:".5s"}),l.fadeIn(),k.off("click",g),k.on("click",f)}var h=$(c.children()[0]),i=h.find(".collapsibleHeader"),j=h.find(".collapsibleImgSmall"),k=h.find(".collapsibleImgLarge"),l=h.find(".content");i.on("click",d),j.on("click",d)}}}]),retailerApp.directive("compareItem",function(){return{restrict:"E",templateUrl:"views/compareItem.html",link:function(a,b){for(var c=b.parent(),d=c.width()+25,e=0,f=0,g=a.compareItems.length;g>f;f++)e=f*d;$(c).css({left:e})}}}),retailerApp.directive("cartItem",function(){return{restrict:"E",templateUrl:"views/cartItem.html"}}),retailerApp.filter("firstLetterCaps",function(){return function(a){if(a){var b=a[0].toUpperCase(),c=a.slice(1,a.length);return b+c}}}),angular.module("retailerApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);