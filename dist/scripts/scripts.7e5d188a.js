"use strict";angular.module("retailerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","LocalStorageModule"]).config(["localStorageServiceProvider",function(a){a.setPrefix("ls")}]).config(["$routeProvider",function(a){a.when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/jewelry/:pageNumber/:category",{templateUrl:"views/main.html",controller:"MainCtrl as main"}).when("/jewelry/:pageNumber/:category/:itemPath/:index",{templateUrl:"views/item.html",controller:"ItemCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/jewelry/0/earrings"})}]);var retailerApp=angular.module("retailerApp");retailerApp.factory("selectedItem",function(){return{data:{}}}),retailerApp.factory("items",["$http","$location",function(a,b){function c(b,c){console.log("Got category items");var e=b+".json";a.get("/scripts/json/"+e).then(function(a){d[b]=a.data.items,sessionStorage.setItem(b,JSON.stringify(d[b])),c&&c()},function(a){console.error("response: ",a)})}var d={};return{currentCategory:"",categories:[],infoList:{items:[]},itemsPerPage:12,pageNumber:0,numberOfPages:1,init:function(b){if(sessionStorage.getItem("categories"))this.categories=sessionStorage.getItem("categories").split(","),b();else{var c=this;a.get("/scripts/json/categories.json").then(function(a){console.log("GOT DATA"),c.categories=a.data.categories,sessionStorage.setItem("categories",c.categories),b()},function(a){console.error("response: ",a)})}},setItems:function(a){if(b.path()){for(var e=b.path().split("/"),f=e[3],g=0,h=this.categories.length;h>g;g++)if(f===this.categories[g]){this.currentCategory=this.categories[g];break}console.log("path: ",e);var i=this,j=function(){var b=0,c=i.itemsPerPage,f=e[2];i.numberOfPages=Math.ceil(d[i.currentCategory].length/i.itemsPerPage);for(var g=0,h=i.numberOfPages;h>g;g++)if(f===g.toString()){i.pageNumber=g;break}b=i.pageNumber*i.itemsPerPage,c=b+i.itemsPerPage,i.infoList.items=d[i.currentCategory].slice(b,c),a()};sessionStorage.getItem(this.currentCategory)?(d[this.currentCategory]=JSON.parse(sessionStorage.getItem(this.currentCategory)),j()):(""===this.currentCategory&&b.path("jewelry/"+this.categories[0]),c(this.currentCategory,j))}}}}]),retailerApp.controller("MainCtrl",["$scope","$http","$timeout","$location","localStorageService","items",function(a,b,c,d,e,f){var g=this;g.categories=[],a.currentCategory="",a.currentItem="",a.categoryHolder="",a.allItems={},a.infoList={items:[]},a.holderInfoList=[],a.searchTerms="",a.compareItems=[],a.holderCompareItems=[],a.cartItems=[],a.cartItemsLength=a.cartItems.length,a.compareItemsLength=a.compareItems.length,a.grandTotal=0,a.pageNumber=0,a.numberOfPages=1,a.showPageNumbers=!1,f.init(function(){g.categories=f.categories}),f.setItems(function(){a.infoList.items=f.infoList.items,a.pageNumber=f.pageNumber,a.numberOfPages=f.numberOfPages}),a.currentCategory=f.currentCategory,a.setCategory=function(b){a.pageNumber=0,d.path("jewelry/"+a.pageNumber+"/"+b)},a.nextPage=function(){a.pageNumber<a.numberOfPages-1&&(a.pageNumber++,d.path("jewelry/"+a.pageNumber+"/"+a.currentCategory)),$("body, html").animate({scrollTop:0},0)},a.previousPage=function(){a.pageNumber>0&&(a.pageNumber--,d.path("jewelry/"+a.pageNumber+"/"+a.currentCategory)),$("body, html").animate({scrollTop:0},0)},a.numberOfPagesDisplay=function(){return a.showPageNumbers=a.numberOfPages>1,new Array(a.numberOfPages)},a.setPageNumber=function(b){a.pageNumber=b,d.path("jewelry/"+a.pageNumber+"/"+a.currentCategory)},a.searchItems=function(){if(a.categoryHolder&&(a.currentCategory=a.categoryHolder),a.searchTerms.length>1&&""!==a.searchTerms){var b,c=a.searchTerms.trim(),d=new RegExp(c,"i"),e=/[\s]+/,f=[];if(0===a.holderInfoList.length)for(var h=0,i=g.categories.length;i>h;h++){var j=a.allItems[g.categories[h]];a.holderInfoList=a.holderInfoList.concat(j)}f=c.split(e),a.infoList.items.length=0;for(var k=0,l=a.holderInfoList.length;l>k;k++){b=a.holderInfoList[k];for(var m in b)if(b.hasOwnProperty(m)&&"image"!==m&&"imageThumb"!==m&&"id"!==m&&"$$hashKey"!==m&&d.test(b[m])&&c.length>3){a.infoList.items.push(b);break}}if(0===a.infoList.items.length)for(var n=0,o=a.holderInfoList.length;o>n;n++){b=a.holderInfoList[k];for(var p in b)if(b.hasOwnProperty(p)&&"image"!==p&&"imageThumb"!==p&&"id"!==p&&"$$hashKey"!==p&&"content"!==p)for(var q=0,r=f.length;r>q;q++){var s=new RegExp(f[q],"i");if(s.test(b[p])){a.infoList.items.push(b);break}}}a.categoryHolder=a.currentCategory,a.currentCategory="Search Results: "+c}},a.$watch("searchTerms.length",function(){0===a.searchTerms.length&&a.holderInfoList.length>0&&(a.infoList.items.length=0,g.setCategory(a.categoryHolder))}),a.$watch("compareItems.length",function(){a.compareItemsLength=a.compareItems.length}),a.$watch("cartItems.length",function(){a.cartItemsLength=a.cartItems.length}),a.addToCart=function(b){b.inCart=!0;for(var c=!1,d=0,e=a.cartItems.length;e>d;d++)b.id===a.cartItems[d].id&&(c=!0);c===!1&&(a.grandTotal+=b.price,a.cartItems.push(b))},a.removeFromCart=function(b){for(var c=0,d=a.cartItems.length;d>c;c++)b===a.cartItems[c]&&(a.grandTotal-=b.price,a.cartItems.splice(c,1),b.inCart=!1)},a.addCompare=function(b){for(var c=!1,d=0,e=a.compareItems.length;e>d;d++)b.id===a.compareItems[d].id&&(c=!0);c===!1&&a.compareItems.push(b)},a.removeCompare=function(b){for(var c,d=$(".compareDisplay li"),e=$(d[0]).width(),f=0,g=a.compareItems.length;g>f;f++)if(b===a.compareItems[f]){c=f,$(d[c]).hide(),a.compareItems.splice(c,1);break}if("undefined"!=typeof c){var h=0;angular.forEach(d,function(a){if(a!==d[c]){var b=h*(e+25);$(a).css({left:b+"px"}),h++}})}},a.switchView=function(b){"compare"===b?a.compareItems.length>0&&($(".collapsibleDisplay").hide(),$(".shoppingCartDisplay").hide(),$(".sortItems").hide(),$(".compareDisplay").show(),$(".showItems").show(),$("body, html").animate({scrollTop:0},0)):"cart"===b&&($(".compareDisplay").hide(),$(".collapsibleDisplay").hide(),$(".shoppingCartDisplay").show(),$(".sortItems").hide(),$(".showItems").show(),$("body, html").animate({scrollTop:0},0))},a.sortItemsByPrice=function(b){c(function(){a.infoList.items.sort(function(a,c){var d,e;return"high"===b?(d=c,e=a):(d=a,e=c),d.price>e.price?1:-1}),$(".collapsibleDisplay").fadeIn()},0)}}]),retailerApp.directive("scroll",["$window","$document",function(a,b){return function(b,c,d){var e=($("body"),$(".collapsibleDisplay")),f=0;angular.element(a).bind("scroll",function(){if(this.pageYOffset+f>=this.innerHeight){console.log("Bottom Reached"),f=0;var a=b.infoList.items.length;console.log("numberOfItems: ",a),b.infoList.items=b.allItems[b.currentCategory].slice(0,a+2),b.$apply()}else f=e.height()})}}]),retailerApp.directive("grid",["selectedItem","$location",function(a,b){return{restrict:"E",templateUrl:"views/grid.html",link:function(c,d){d.on("click",function(){c.index=+$(d.children()[0]).context.id,a.data=c.infoList.items[c.index],c.itemPath=a.data.title.toLowerCase().split(/[\s]+/).join("-"),b.path("jewelry/"+c.pageNumber+"/"+c.currentCategory+"/"+c.itemPath+"/"+c.index),c.$apply()})}}}]),retailerApp.directive("collapsible",["$window",function(a){return{restrict:"E",templateUrl:"views/collapsible.html",link:function(b,c){function d(){var b=a.outerHeight,c=i.offset().top;k.attr("src",j.attr("src").replace("thumb_","")),j.fadeOut(),$("body, html").animate({scrollTop:c}),k.animate({opacity:1},800),h.addClass("expand").css({height:b}),k.on("click",f),i.off("click",d),i.on("click",e)}function e(){b.currentItem="",h.removeClass("expand").css({height:"75px",transition:".8s"}),k.animate({opacity:0},320),j.delay(200).fadeIn(),k.hasClass("zoom")&&g(),i.on("click",d),i.off("click",e),k.on("click",d)}function f(){k.addClass("zoom"),l.fadeOut(),k.css({marginLeft:"12%"}),k.off("click",f),k.on("click",g)}function g(){k.css({marginLeft:0}),k.removeClass("zoom").css({transition:".5s"}),l.fadeIn(),k.off("click",g),k.on("click",f)}var h=$(c.children()[0]),i=h.find(".collapsibleHeader"),j=h.find(".collapsibleImgSmall"),k=h.find(".collapsibleImgLarge"),l=h.find(".content");i.on("click",d),j.on("click",d)}}}]),retailerApp.directive("compareItem",function(){return{restrict:"E",templateUrl:"views/compareItem.html",link:function(a,b){for(var c=b.parent(),d=c.width()+25,e=0,f=0,g=a.compareItems.length;g>f;f++)e=f*d;$(c).css({left:e})}}}),retailerApp.directive("cartItem",function(){return{restrict:"E",templateUrl:"views/cartItem.html"}}),retailerApp.filter("firstLetterCaps",function(){return function(a){if(a){var b=a[0].toUpperCase(),c=a.slice(1,a.length);return b+c}}});var retailerApp=angular.module("retailerApp");retailerApp.controller("ItemCtrl",["$scope","$location","selectedItem","items",function(a,b,c,d){a.infoList={items:[]},a.pageNumber=0,a.setCategory=function(c){b.path("jewelry/"+a.pageNumber+"/"+c)},a.item=c.data,a.loadItem=function(){a.item&&JSON.stringify(a.item)!==JSON.stringify({})?d.init(function(){a.categories=d.categories,$("body, html").animate({scrollTop:0},0)}):d.init(function(){a.categories=d.categories,d.setItems(function(){for(var c=b.path().split("/")[5],e=-1,f=0,g=d.infoList.items.length;g>f;f++)if(c===f.toString()){e=f;break}a.item=d.infoList.items[e]})})}}]),angular.module("retailerApp").controller("AboutCtrl",["$scope","selectedItem",function(a,b){!function(){console.log("selectedItem.data: ",b.data)}(),this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("retailerAccordionDisplayApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/cartItem.html",'<div class="cartItem"> <img class="cartImage" ng-src="{{ cartItem.image }}"> <p class="cartItemName">{{ cartItem.title }}</p> <span class="removeFromCart" ng-click="removeFromCart(cartItem)">Remove From Cart</span> <span class="cartItemPrice">{{ cartItem.price | currency:$ }}</span> </div>'),a.put("views/collapsible.html",'<div class="collapsibleItem"> <img class="collapsibleImgSmall" ng-src="{{ item.imageThumb }}"> <div class="collapsibleHeader"> <span class="collapsibleTitle">{{ item.title }}</span> <p class="itemPrice">{{ item.price | currency:$ }}</p> <span class="collapsibleDescription">{{ item.description }}</span> <span class="cartStatus" ng-show="item.inCart" ng-click="switchView(\'cart\')"><em>In Cart</em></span> </div> <img class="collapsibleImgLarge"> <span class="content"> <p class="collapsibleContent">{{ item.content }}</p> <span class="addToCart" ng-click="addToCart(item)">Add to Cart</span> <span class="compare" ng-click="addCompare(item)">Compare</span> </span> </div> <script>/*\n        $(\'.collapsibleDisplay\').fadeOut(100);\n        $(\'.shoppingCartDisplay\').hide();\n        $(\'.compareDisplay\').hide();\n        $(\'.sortItems\').show();\n\n        function display(delay) {\n            if (!delay) {\n                delay = 150;\n            }\n            $timeout(function() {\n                $scope.currentCategory = category;\n                $scope.infoList.items = $scope.allItems[category].slice();\n                $timeout(function() {\n                    $(\'.collapsibleDisplay\').fadeIn("fast");\n                //    $location.path($scope.currentCategory);\n                }, 100);\n            }, delay);\n        }\n\n        if ($scope.allItems[category]) {\n            display(150);\n        } else {\n            getCategoryItems(category, display, 150);\n        }\n        */</script>'),a.put("views/compareItem.html",'<img class="compareImg" ng-src="{{ compare.image }}"> <span class="removeCompare" ng-click="removeCompare(compare)">Remove</span> <span class="addToCartCompare" ng-click="addToCart(compare)">Add to Cart</span> <p class="compareTitle">{{ compare.title }}</p> <span class="comparePrice">{{ compare.price | currency:$ }}</span>'),a.put("views/grid.html",'<span id="{{ $index }}" class="gridItem"> <img class="gridImageSmall" ng-src="{{ item.imageThumb }}"> <span class="gridItemTitle">{{ item.title }}</span> <span class="gridItemPrice">{{ item.price | currency:$ }}</span> </span>'),a.put("views/item.html",'<div class="categories"> <span class="category" ng-click="setCategory(category)" ng-repeat="category in categories"> {{ category | firstLetterCaps }} </span> </div> <div class="itemContainer" ng-init="loadItem()"> <div class="gridImageLargeContainer"> <img class="gridImageLarge" src="{{ item.image }}"> </div> <span class="itemTitle">{{ item.title }}</span> <span>{{ item.description }}</span> <br> <span>{{ item.content }}</span> </div>'),a.put("views/main.html",'<div class="container"> <!--\n    <div class="categories">\n        <span class="category" ng-click="setCategory(category)" ng-repeat="category in main.categories">\n            {{ category | firstLetterCaps }}\n        </span>\n    </div>\n    --> <!--\n    <span class="cartNav" ng-click="switchView(\'cart\')">Shopping Cart:\n        {{ cartItemsLength || "Empty" }}\n    </span>\n    <span class="compareNav" ng-click="switchView(\'compare\')">Compare:\n        {{ compareItemsLength }}\n    </span>\n    <span class="sortItems"><p class="searchText">Sort/Search</p>\n        <div>\n            <span ng-click="sortItemsByPrice(\'low\')">Price Low</span>\n            <span ng-click="sortItemsByPrice(\'high\')">Price High</span>\n        </div>\n        <form class="form-search">\n            <div class="input-append">\n                <input placeholder="Search" type="text" class="span2 search-query" ng-model="searchTerms">\n                <button class="btn btn-default glyphicon glyphicon-search" ng-click="searchItems()"></button>\n            </div>\n        </form>\n    </span>\n    --> <span class="categoryTitle">{{ currentCategory | firstLetterCaps }}</span> <ul class="navContainer"> NAV CONTAINER <li class="category" ng-click="setCategory(category)" ng-repeat="category in main.categories"> {{ category | firstLetterCaps }} </li> <li ng-click="switchView(\'cart\')">Shopping Cart: {{ cartItemsLength || "Empty" }} </li> <li ng-click="switchView(\'compare\')">Compare: {{ compareItemsLength }} </li> <li><p class="searchText">Sort/Search</p> <div> <span ng-click="sortItemsByPrice(\'low\')">Price Low</span> <span ng-click="sortItemsByPrice(\'high\')">Price High</span> </div> <form class="form-search"> <div class="input-append"> <input placeholder="Search" type="text" class="span2 search-query" ng-model="searchTerms"> <button class="btn btn-default glyphicon glyphicon-search" ng-click="searchItems()"></button> </div> </form> </li> </ul> <div class="gridDisplay"> <span class="pageNavContainer"> <span ng-show="showPageNumbers"> <span class="previousPage" ng-click="previousPage()">Previous</span> <span class="pageNumbers" ng-class="{\'currentPageNumber\': pageNumber === $index}" ng-repeat="page in numberOfPagesDisplay() track by $index" ng-click="setPageNumber($index)">{{ $index + 1 }}</span> <span class="nextPage" ng-click="nextPage()">Next</span> </span> </span> <span class="gridItemWrapper" ng-repeat="item in infoList.items"> <grid></grid> </span> </div> <span ng-show="showPageNumbers" class="pageNavContainer"> <span class="previousPage" ng-click="previousPage()">Previous</span> <span class="pageNumbers" ng-class="{\'currentPageNumber\': pageNumber === $index}" ng-repeat="page in numberOfPagesDisplay() track by $index" ng-click="setPageNumber($index)">{{ $index + 1 }}</span> <span class="nextPage" ng-click="nextPage()">Next</span> </span> <!--\n    <div class="collapsibleDisplay">\n        <h2 class="displayTitle">{{ currentCategory || "" | firstLetterCaps }}</h2>\n        <div ng-repeat="item in infoList.items">\n            <collapsible></collapsible>\n        </div>\n    </div>\n    --> <div class="compareDisplay"> <h2 class="displayTitle">Compare</h2> <ul> <li ng-repeat="compare in compareItems"> <compare-item></compare-item> </li> </ul> </div> <div class="shoppingCartDisplay"> <h2 class="displayTitle">Shopping Cart</h2> <div ng-repeat="cartItem in cartItems"> <cart-item></cart-item> </div> <div class="cartBottomLine"> <span class="grandTotal">Grand Total: {{ grandTotal | currency:$ }}</span> </div> </div> </div>')}]);